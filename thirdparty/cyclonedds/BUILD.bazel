link_options = select({
    "@bazel_tools//src/conditions:darwin": [
        "-undefined dynamic_lookup",
        "-pthread",
        "-dynamiclib",
    ],
    "//conditions:default": ["-pthread"],
})

dds_hdrs = glob([
    "include/dds/*.h",
    "include/dds/**/*.h",
])
ddsc_hdrs = glob(["include/ddsc/*.h",])
ddscxx_hdrs = glob([
    "include/ddscxx/*.hpp",
    "include/ddscxx/**/*.hpp",
])

cc_import(
    name = "shared_import_ddsc",
    hdrs = dds_hdrs + ddsc_hdrs,
    includes = [
        "include",
        "include/ddsc",
    ],
    shared_library = select({
        "@platforms//cpu:x86_64": "lib/x86_64/libddsc.so",
        "@platforms//cpu:arm64": "lib/aarch64/libddsc.so",
        "//conditions:default": "@platforms//:incompatible",
    }),
)

cc_library(
    name = "lib_ddsc",
    hdrs = dds_hdrs + ddsc_hdrs,
    includes = [
        "include",
        "include/ddsc",
    ],
    deps = [":shared_import_ddsc"],
    copts = ["-fPIC"],
    linkopts = link_options,
    alwayslink = True,
    visibility = ["//visibility:public"],
)

cc_import(
    name = "shared_import_ddscxx",
    hdrs = dds_hdrs + ddscxx_hdrs,
    includes = [
        "include",
        "include/ddscxx",
    ],
    shared_library = select({
        "@platforms//cpu:x86_64": "lib/x86_64/libddscxx.so",
        "@platforms//cpu:arm64": "lib/aarch64/libddscxx.so",
        "//conditions:default": "@platforms//:incompatible",
    }),
)

cc_library(
    name = "lib_ddscxx",
    hdrs = dds_hdrs + ddscxx_hdrs,
    includes = [
        "include",
        "include/ddscxx",
    ],
    deps = [":shared_import_ddscxx"],
    copts = ["-fPIC"],
    linkopts = link_options,
    alwayslink = True,
    visibility = ["//visibility:public"],
)


# Autogenerated:
# ddsc_lib = cc_library(
#     name = "ddsc",
#     hdrs = dds_hdrs + ddsc_hdrs,
#     shared_library = select({
#         "@platforms//cpu:x86_64": ["lib/x86_64/libddsc.so"],
#         "@platforms//cpu:arm64": ["lib/aarch64/libddsc.so"],
#         "//conditions:default": ["@platforms//:incompatible"],
#     }),
#     shared_library_symlink = True,
#     shared_library_link = True,
#     shared_library_args = ["-Wl,-rpath,$ORIGIN"],
#     shared_library_link_args = ["-Wl,-rpath, $ORIGIN"],
#     shared_library_deps = ["@threads"],
#     visibility = ["//visibility:public"],
# )